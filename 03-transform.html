<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Foundations of Astronomical Data Science: Plotting and Tabular Data</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/dc/favicon-16x16.png"><link rel="manifest" href="favicons/dc/site.webmanifest"><link rel="mask-icon" href="favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/03-transform.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Foundations of Astronomical Data Science
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Foundations of Astronomical Data Science
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Foundations of Astronomical Data Science
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 29%" class="percentage">
    29%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 29%" aria-valuenow="29" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/03-transform.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-query.html">1. Basic Queries</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-coords.html">2. Coordinate Transformations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Plotting and Tabular Data
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#selecting-rows-and-columns">Selecting rows and columns</a></li>
<li><a href="#scatter-plot">Scatter plot</a></li>
<li><a href="#transform-back">Transform back</a></li>
<li><a href="#reflex-correction">Reflex Correction</a></li>
<li><a href="#pandas-dataframe">Pandas DataFrame</a></li>
<li><a href="#saving-the-dataframe">Saving the DataFrame</a></li>
<li><a href="#summary">Summary</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-motion.html">4. Plotting and Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-select.html">5. Transform and Select</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-join.html">6. Join</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-photo.html">7. Photometry</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-plot.html">8. Visualization</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-coords.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="04-motion.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-coords.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Coordinate
        </a>
        <a class="chapter-link float-end" href="04-motion.html" rel="next">
          Next: Plotting and Pandas...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Plotting and Tabular Data</h1>
        <p>Last updated on 2024-03-08 |

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/03-transform.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do we make scatter plots in Matplotlib?</li>
<li>How do we store data in a Pandas <code>DataFrame</code>?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Select rows and columns from an Astropy <code>Table</code>.</li>
<li>Use Matplotlib to make a scatter plot.</li>
<li>Use Gala to transform coordinates.</li>
<li>Make a Pandas <code>DataFrame</code> and use a Boolean
<code>Series</code> to select rows.</li>
<li>Save a <code>DataFrame</code> in an HDF5 file.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In the previous episode, we wrote a query to select stars from the
region of the sky where we expect GD-1 to be, and saved the results in a
FITS file.</p>
<p>Now we will read that data back in and implement the next step in the
analysis, identifying stars with the proper motion we expect for
GD-1.</p>
<div id="outline" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<span class="callout-header">Checklist</span>
<div id="outline" class="callout-inner">
<h3 class="callout-title">Outline</h3>
<div class="callout-content">
<ol style="list-style-type: decimal"><li><p>We will read back the results from the previous lesson, which we
saved in a FITS file.</p></li>
<li><p>Then we will transform the coordinates and proper motion data
from ICRS back to the coordinate frame of GD-1.</p></li>
<li><p>We will put those results into a Pandas
<code>DataFrame</code>.</p></li>
</ol></div>
</div>
</div>
<div id="starting-from-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<span class="callout-header">Prerequisite</span>
<div id="starting-from-this-episode" class="callout-inner">
<h3 class="callout-title">Starting from this episode</h3>
<div class="callout-content">
<p>If you are starting a new notebook for this episode, expand this
section for information you will need to get started.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Read me </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>In the previous episode, we ran a query on the Gaia server,
downloaded data for roughly 140,000 stars, and saved the data in a FITS
file. We will use that data for this episode. Whether you are working
from a new notebook or coming back from a checkpoint, reloading the data
will save you from having to run the query again.</p>
<p>If you are starting this episode here or starting this episode in a
new notebook, you will need to run the following lines of code.</p>
<p>This imports previously imported functions:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> astropy.units <span class="im">as</span> u</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> astropy.coordinates <span class="im">import</span> SkyCoord</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">from</span> gala.coordinates <span class="im">import</span> GD1Koposov10</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">from</span> astropy.table <span class="im">import</span> Table</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="im">from</span> episode_functions <span class="im">import</span> <span class="op">*</span></span></code></pre>
</div>
<p>The following code loads in the data (instructions for downloading
data can be found in the <a href="index.html#setup">setup instructions</a>).
You may need to add a the path to the filename variable below
(e.g. <code>filename = 'student_download/backup-data/gd1_results.fits'</code>)</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'gd1_results.fits'</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>polygon_results <span class="op">=</span> Table.read(filename)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>gd1_frame <span class="op">=</span> GD1Koposov10()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="selecting-rows-and-columns">Selecting rows and columns<a class="anchor" aria-label="anchor" href="#selecting-rows-and-columns"></a></h2>
<hr class="half-width"><p>In the previous episode, we selected spatial and proper motion
information from the Gaia catalog for stars around a small part of GD-1.
The output was returned as an Astropy <code>Table</code>. We can use
<code>info</code> to check the contents.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>polygon_results.info()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=140339&gt;
   name    dtype    unit                              description
--------- ------- -------- ------------------------------------------------------------------
source_id   int64          Unique source identifier (unique within a particular Data Release)
       ra float64      deg                                                    Right ascension
      dec float64      deg                                                        Declination
     pmra float64 mas / yr                         Proper motion in right ascension direction
    pmdec float64 mas / yr                             Proper motion in declination direction
 parallax float64      mas                                                           Parallax</code></pre>
</div>
<p>In this episode, we will see operations for selecting columns and
rows from an Astropy <code>Table</code>. You can find more information
about these operations in the <a href="https://docs.astropy.org/en/stable/table/access_table.html" class="external-link">Astropy
documentation</a>.</p>
<p>We can get the names of the columns like this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>polygon_results.colnames</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>['source_id', 'ra', 'dec', 'pmra', 'pmdec', 'parallax']</code></pre>
</div>
<p>And select an individual column like this:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>polygon_results[<span class="st">'ra'</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Column name='ra' dtype='float64' unit='deg' description='Right ascension' length=140339&gt;
142.48301935991023
142.25452941346344
142.64528557468074
142.57739430926034
142.58913564478618
141.81762228999614
143.18339801317677
 142.9347319464589
142.26769745823267
142.89551292869012
[Output truncated]</code></pre>
</div>
<p>The result is a <code>Column</code> object that contains the data,
and also the data type, units, and name of the column.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="bu">type</span>(polygon_results[<span class="st">'ra'</span>])</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.table.column.Column</span></span></code></pre>
</div>
<p>The rows in the <code>Table</code> are numbered from 0 to
<code>n-1</code>, where <code>n</code> is the number of rows. We can
select the first row like this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>polygon_results[<span class="dv">0</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Row index=0&gt;
    source_id              ra                dec                pmra              pmdec             parallax
                          deg                deg              mas / yr           mas / yr             mas
      int64             float64            float64            float64            float64            float64
------------------ ------------------ ----------------- ------------------- ----------------- -------------------
637987125186749568 142.48301935991023 21.75771616932985 -2.5168384683875766 2.941813096629439 -0.2573448962333354</code></pre>
</div>
<p>The result is a <code>Row</code> object.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="bu">type</span>(polygon_results[<span class="dv">0</span>])</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.table.row.Row</span></span></code></pre>
</div>
<p>Notice that the bracket operator can be used to select both columns
and rows. You might wonder how it knows which to select. If the
expression in brackets is a string, it selects a column; if the
expression is an integer, it selects a row.</p>
<p>If you apply the bracket operator twice, you can select a column and
then an element from the column.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>polygon_results[<span class="st">'ra'</span>][<span class="dv">0</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">142.48301935991023</span></span></code></pre>
</div>
<p>Or you can select a row and then an element from the row.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>polygon_results[<span class="dv">0</span>][<span class="st">'ra'</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">142.48301935991023</span></span></code></pre>
</div>
<p>You get the same result either way.</p>
</section><section><h2 class="section-heading" id="scatter-plot">Scatter plot<a class="anchor" aria-label="anchor" href="#scatter-plot"></a></h2>
<hr class="half-width"><p>To see what the results look like, we will use a scatter plot. The
library we will use is <a href="https://matplotlib.org/" class="external-link">Matplotlib</a>,
which is the most widely-used plotting library for Python. The
Matplotlib interface is based on MATLAB (hence the name), so if you know
MATLAB, some of it will be familiar.</p>
<p>We will import like this:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre>
</div>
<p>Pyplot is part of the Matplotlib library. It is conventional to
import it using the shortened name <code>plt</code>.</p>
<div id="keeping-plots-in-the-notebook" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="keeping-plots-in-the-notebook" class="callout-inner">
<h3 class="callout-title">Keeping plots in the notebook</h3>
<div class="callout-content">
<p>In recent versions of Jupyter, plots appear “inline”; that is, they
are part of the notebook. In some older versions, plots appear in a new
window. If your plots appear in a new window, you might want to run the
following Jupyter <a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-matplotlib" class="external-link">magic
command</a> in a notebook cell:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code></pre>
</div>
</div>
</div>
</div>
<p>Pyplot provides two functions that can make scatter plots, <a href="https://matplotlib.org/3.3.0/api/_as_gen/matplotlib.pyplot.scatter.html" class="external-link">plt.scatter</a>
and <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html" class="external-link">plt.plot</a>.</p>
<ul><li><p><code>scatter</code> is more versatile; for example, you can make
every point in a scatter plot a different color.</p></li>
<li><p><code>plot</code> is more limited, but for simple cases, it can
be substantially faster.</p></li>
</ul><p>Jake Vanderplas explains these differences in <a href="https://jakevdp.github.io/PythonDataScienceHandbook/04.02-simple-scatter-plots.html" class="external-link">The
Python Data Science Handbook</a>.</p>
<p>Since we are plotting more than 100,000 points and they are all the
same size and color, we will use <code>plot</code>.</p>
<p>Here is a scatter plot of the stars we selected in the GD-1 region
with right ascension on the x-axis and declination on the y-axis, both
ICRS coordinates in degrees.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>x <span class="op">=</span> polygon_results[<span class="st">'ra'</span>]</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>y <span class="op">=</span> polygon_results[<span class="st">'dec'</span>]</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>plt.plot(x, y, <span class="st">'ko'</span>)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>plt.xlabel(<span class="st">'ra (degree ICRS)'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>plt.ylabel(<span class="st">'dec (degree ICRS)'</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Figure size 432x288 with 1 Axes&gt;</code></pre>
</div>
<figure><img src="fig/03-transform_files/03-transform_28_0.png" alt="Scatter plot of right ascension and declination in ICRS coordinates, demonstrating overplotting." class="figure mx-auto d-block"></figure><p>The arguments to <code>plt.plot</code> are <code>x</code>,
<code>y</code>, and a string that specifies the style. In this case, the
letters <code>ko</code> indicate that we want a black, round marker
(<code>k</code> is for black because <code>b</code> is for blue). The
functions <code>xlabel</code> and <code>ylabel</code> put labels on the
axes.</p>
<p>Looking at this plot, we can see that the region we selected, which
is a rectangle in GD-1 coordinates, is a non-rectanglar region in ICRS
coordinates.</p>
<p>However, this scatter plot has a problem. It is “<a href="https://python-graph-gallery.com/134-how-to-avoid-overplotting-with-python/" class="external-link">overplotted</a>”,
which means that there are so many overlapping points, we cannot
distinguish between high and low density areas.</p>
<p>To fix this, we can provide optional arguments to control the size
and transparency of the points.</p>
<div id="exercise-5-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-5-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (5 minutes)</h3>
<div class="callout-content">
<p>In the call to <code>plt.plot</code>, use the keyword argument
<code>markersize</code> to make the markers smaller.</p>
<p>Then add the keyword argument <code>alpha</code> to make the markers
partly transparent.</p>
<p>Adjust these arguments until you think the figure shows the data most
clearly.</p>
<p>Note: Once you have made these changes, you might notice that the
figure shows stripes with lower density of stars. These stripes are
caused by the way Gaia scans the sky, which <a href="https://www.cosmos.esa.int/web/gaia/scanning-law" class="external-link">you can read
about here</a>. The dataset we are using, <a href="https://www.cosmos.esa.int/web/gaia/dr2" class="external-link">Gaia Data Release 2</a>,
covers 22 months of observations; during this time, some parts of the
sky were scanned more than others.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>x <span class="op">=</span> polygon_results[<span class="st">'ra'</span>]</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>y <span class="op">=</span> polygon_results[<span class="st">'dec'</span>]</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>plt.plot(x, y, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="fl">0.1</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>plt.xlabel(<span class="st">'ra (degree ICRS)'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>plt.ylabel(<span class="st">'dec (degree ICRS)'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="transform-back">Transform back<a class="anchor" aria-label="anchor" href="#transform-back"></a></h2>
<hr class="half-width"><p>Remember that we selected data from a rectangle of coordinates in the
GD-1 frame, then transformed them to ICRS when we constructed the query.
The coordinates in the query results are in ICRS.</p>
<p>To plot them, we will transform them back to the GD-1 frame; that
way, the axes of the figure are aligned with the orbit of GD-1, which is
useful for two reasons:</p>
<ul><li><p>By transforming the coordinates, we can identify stars that are
likely to be in GD-1 by selecting stars near the centerline of the
stream, where φ<sub>2</sub> is close to 0.</p></li>
<li><p>By transforming the proper motions, we can identify stars with
non-zero proper motion along the φ<sub>1</sub> axis, which are likely to
be part of GD-1.</p></li>
</ul><p>To do the transformation, we will put the results into a
<code>SkyCoord</code> object. In a previous episode, we created a
<code>SkyCoord</code> object like this:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>skycoord <span class="op">=</span> SkyCoord(ra<span class="op">=</span>polygon_results[<span class="st">'ra'</span>], dec<span class="op">=</span>polygon_results[<span class="st">'dec'</span>])</span></code></pre>
</div>
<p>Notice that we did not specify the reference frame. That is because
when using <code>ra</code> and <code>dec</code> in
<code>SkyCoord</code>, the <code>ICRS</code> frame is assumed by
default.</p>
<p>The <code>SkyCoord</code> object can keep track not just of location,
but also proper motions. This means that we can initialize a
<code>SkyCoord</code> object with location and proper motions, then use
all of these quantities together to transform into the GD-1 frame.</p>
<p>Now we are going to do something similar, but now we will take
advantage of the <code>SkyCoord</code> object’s capacity to include and
track space motion information in addition to <code>ra</code> and
<code>dec</code>. We will now also include:</p>
<ul><li><p><code>pmra</code> and <code>pmdec</code>, which are proper motion
in the <code>ICRS</code> frame, and</p></li>
<li><p><code>distance</code> and <code>radial_velocity</code>, which are
important for the reflex correction and will be discussed in that
section.</p></li>
</ul><div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>distance <span class="op">=</span> <span class="dv">8</span> <span class="op">*</span> u.kpc</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>radial_velocity<span class="op">=</span> <span class="dv">0</span> <span class="op">*</span> u.km<span class="op">/</span>u.s</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>skycoord <span class="op">=</span> SkyCoord(ra<span class="op">=</span>polygon_results[<span class="st">'ra'</span>], </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>                    dec<span class="op">=</span>polygon_results[<span class="st">'dec'</span>],</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                    pm_ra_cosdec<span class="op">=</span>polygon_results[<span class="st">'pmra'</span>],</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>                    pm_dec<span class="op">=</span>polygon_results[<span class="st">'pmdec'</span>], </span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>                    distance<span class="op">=</span>distance, </span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>                    radial_velocity<span class="op">=</span>radial_velocity)</span></code></pre>
</div>
<p>For the first four arguments, we use columns from
<code>polygon_results</code>.</p>
<p>For <code>distance</code> and <code>radial_velocity</code> we use
constants, which we explain in the section on reflex correction.</p>
<p>The result is an Astropy <code>SkyCoord</code> object, which we can
transform to the GD-1 frame.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>transformed <span class="op">=</span> skycoord.transform_to(gd1_frame)</span></code></pre>
</div>
<p>The result is another <code>SkyCoord</code> object, now in the GD-1
frame.</p>
</section><section><h2 class="section-heading" id="reflex-correction">Reflex Correction<a class="anchor" aria-label="anchor" href="#reflex-correction"></a></h2>
<hr class="half-width"><p>The next step is to correct the proper motion measurements for the
effect of the motion of our solar system around the Galactic center.</p>
<p>When we created <code>skycoord</code>, we provided constant values
for <code>distance</code> and <code>radial_velocity</code> rather than
measurements from Gaia.</p>
<p>That might seem like a strange thing to do, but here is the
motivation:</p>
<ul><li><p>Because the stars in GD-1 are so far away, parallaxes measured by
Gaia are negligible, making the distance estimates unreliable.<br>
So we replace them with our current best estimate of the mean distance
to GD-1, about 8 kpc. See <a href="https://ui.adsabs.harvard.edu/abs/2010ApJ...712..260K/abstract" class="external-link">Koposov,
Rix, and Hogg, 2010</a>.</p></li>
<li><p>For the other stars in the table, this distance estimate will be
inaccurate, so reflex correction will not be correct. But that should
have only a small effect on our ability to identify stars with the
proper motion we expect for GD-1.</p></li>
<li><p>The measurement of radial velocity has no effect on the
correction for proper motion, but we have to provide a value to avoid
errors in the reflex correction calculation. So we provide
<code>0</code> as an arbitrary place-keeper.</p></li>
</ul><p>With this preparation, we can use <code>reflex_correct</code> from
Gala (<a href="https://gala-astro.readthedocs.io/en/latest/api/gala.coordinates.reflex_correct.html" class="external-link">documentation
here</a>) to correct for the motion of the solar system.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="im">from</span> gala.coordinates <span class="im">import</span> reflex_correct</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>skycoord_gd1 <span class="op">=</span> reflex_correct(transformed)</span></code></pre>
</div>
<p>The result is a <code>SkyCoord</code> object that contains</p>
<ul><li><p><code>phi1</code> and <code>phi2</code>, which represent the
transformed coordinates in the GD-1 frame.</p></li>
<li><p><code>pm_phi1_cosphi2</code> and <code>pm_phi2</code>, which
represent the transformed proper motions that have been corrected for
the motion of the solar system around the Galactic center.</p></li>
</ul><p>We can select the coordinates and plot them like this:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>x <span class="op">=</span> skycoord_gd1.phi1</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>y <span class="op">=</span> skycoord_gd1.phi2</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>plt.plot(x, y, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="fl">0.1</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>plt.xlabel(<span class="st">'phi1 (degree GD1)'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>plt.ylabel(<span class="st">'phi2 (degree GD1)'</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Figure size 432x288 with 1 Axes&gt;</code></pre>
</div>
<figure><img src="fig/03-transform_files/03-transform_43_0.png" alt="Scatter plot of phi1 versus phi2 in GD-1 coordinates, showing selected region is rectangular." class="figure mx-auto d-block"></figure><p>We started with a rectangle in the GD-1 frame. When transformed to
the ICRS frame, it is a non-rectangular region. Now, transformed back to
the GD-1 frame, it is a rectangle again.</p>
</section><section><h2 class="section-heading" id="pandas-dataframe">Pandas DataFrame<a class="anchor" aria-label="anchor" href="#pandas-dataframe"></a></h2>
<hr class="half-width"><p>At this point we have two objects containing different sets of the
data relating to identifying stars in GD-1. <code>polygon_results</code>
is the Astropy <code>Table</code> we downloaded from Gaia.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="bu">type</span>(polygon_results)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.table.table.Table</span></span></code></pre>
</div>
<p>And <code>skycoord_gd1</code> is a <code>SkyCoord</code> object that
contains the transformed coordinates and proper motions.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="bu">type</span>(skycoord_gd1)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.coordinates.sky_coordinate.SkyCoord</span></span></code></pre>
</div>
<p>On one hand, this division of labor makes sense because each object
provides different capabilities. But working with multiple object types
can be awkward. It will be more convenient to choose one object and get
all of the data into it.</p>
<p>Now we can extract the columns we want from <code>skycoord_gd1</code>
and add them as columns in the Astropy <code>Table</code>
<code>polygon_results</code>. <code>phi1</code> and <code>phi2</code>
contain the transformed coordinates.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>polygon_results[<span class="st">'phi1'</span>] <span class="op">=</span> skycoord_gd1.phi1</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>polygon_results[<span class="st">'phi2'</span>] <span class="op">=</span> skycoord_gd1.phi2</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>polygon_results.info()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=140339&gt;
   name    dtype    unit                              description                                class
--------- ------- -------- ------------------------------------------------------------------ ------------
source_id   int64          Unique source identifier (unique within a particular Data Release) MaskedColumn
       ra float64      deg                                                    Right ascension MaskedColumn
      dec float64      deg                                                        Declination MaskedColumn
     pmra float64 mas / yr                         Proper motion in right ascension direction MaskedColumn
    pmdec float64 mas / yr                             Proper motion in declination direction MaskedColumn
 parallax float64      mas                                                           Parallax MaskedColumn
     phi1 float64      deg                                                                          Column
     phi2 float64      deg                                                                          Column</code></pre>
</div>
<p><code>pm_phi1_cosphi2</code> and <code>pm_phi2</code> contain the
components of proper motion in the transformed frame.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>polygon_results[<span class="st">'pm_phi1'</span>] <span class="op">=</span> skycoord_gd1.pm_phi1_cosphi2</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>polygon_results[<span class="st">'pm_phi2'</span>] <span class="op">=</span> skycoord_gd1.pm_phi2</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>polygon_results.info()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=140339&gt;
   name    dtype    unit                              description                                class
--------- ------- -------- ------------------------------------------------------------------ ------------
source_id   int64          Unique source identifier (unique within a particular Data Release) MaskedColumn
       ra float64      deg                                                    Right ascension MaskedColumn
      dec float64      deg                                                        Declination MaskedColumn
     pmra float64 mas / yr                         Proper motion in right ascension direction MaskedColumn
    pmdec float64 mas / yr                             Proper motion in declination direction MaskedColumn
 parallax float64      mas                                                           Parallax MaskedColumn
     phi1 float64      deg                                                                          Column
     phi2 float64      deg                                                                          Column
  pm_phi1 float64 mas / yr                                                                          Column
  pm_phi2 float64 mas / yr                                                                          Column</code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Detail If you notice that <code>SkyCoord</code> has an attribute
called <code>proper_motion</code>, you might wonder why we are not using
it.</p>
<p>We could have: <code>proper_motion</code> contains the same data as
<code>pm_phi1_cosphi2</code> and <code>pm_phi2</code>, but in a
different format.</p>
</div>
</div>
</div>
<div id="pandas-dataframes-versus-astropy-tables" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="pandas-dataframes-versus-astropy-tables" class="callout-inner">
<h3 class="callout-title">Pandas <code>DataFrame</code>s versus Astropy
<code>Table</code>s</h3>
<div class="callout-content">
<p>Two common choices are the Pandas <code>DataFrame</code> and Astropy
<code>Table</code>. Pandas <code>DataFrame</code>s and Astropy
<code>Table</code>s share many of the same characteristics and most of
the manipulations that we do can be done with either. As you become more
familiar with each, you will develop a sense of which one you prefer for
different tasks. For instance you may choose to use Astropy
<code>Table</code>s to read in data, especially astronomy specific data
formats, but Pandas <code>DataFrame</code>s to inspect the data.
Fortunately, Astropy makes it easy to convert between the two data
types. We will choose to use Pandas <code>DataFrame</code>, for two
reasons:</p>
<ol style="list-style-type: decimal"><li><p>It provides capabilities that are (almost) a superset of the
other data structures, so it is the all-in-one solution.</p></li>
<li><p>Pandas is a general-purpose tool that is useful in many domains,
especially data science. If you are going to develop expertise in one
tool, Pandas is a good choice.</p></li>
</ol><p>However, compared to an Astropy <code>Table</code>, Pandas has one
big drawback: it does not keep the metadata associated with the table,
including the units for the columns. Nevertheless, we think its a useful
data type to be familiar with.</p>
</div>
</div>
</div>
<p>It is straightforward to convert an Astropy <code>Table</code> to a
Pandas <code>DataFrame</code>.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>results_df <span class="op">=</span> polygon_results.to_pandas()</span></code></pre>
</div>
<p><code>DataFrame</code> provides <code>shape</code>, which shows the
number of rows and columns.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>results_df.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(140339, 10)</code></pre>
</div>
<p>It also provides <code>head</code>, which displays the first few
rows. <code>head</code> is useful for spot-checking large results as you
go along.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>results_df.head()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            source_id          ra        dec       pmra       pmdec   parallax        phi1       phi2    pm_phi1     pm_phi2
0  637987125186749568  142.483019  21.757716  -2.516838    2.941813  -0.257345  -54.975623  -3.659349   6.429945    6.518157
1  638285195917112960  142.254529  22.476168   2.662702  -12.165984   0.422728  -54.498247  -3.081524  -3.168637   -6.206795
2  638073505568978688  142.645286  22.166932  18.306747   -7.950660   0.103640  -54.551634  -3.554229   9.129447  -16.819570
3  638086386175786752  142.577394  22.227920   0.987786   -2.584105  -0.857327  -54.536457  -3.467966   3.837120    0.526461
4  638049655615392384  142.589136  22.110783   0.244439   -4.941079   0.099625  -54.627448  -3.542738   1.466103   -0.185292
</code></pre>
</div>
<div id="attributes-vs-functions" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="attributes-vs-functions" class="callout-inner">
<h3 class="callout-title">Attributes vs functions</h3>
<div class="callout-content">
<p><code>shape</code> is an attribute, so we display its value without
calling it as a function.</p>
<p><code>head</code> is a function, so we need the parentheses.</p>
</div>
</div>
</div>
<p>Before we go any further, we will take all of the steps that we have
done and consolidate them into a single function that we can use to take
the coordinates and proper motion that we get as an Astropy
<code>Table</code> from our Gaia query, add columns representing the
reflex corrected GD-1 coordinates and proper motions, and transform it
into a Pandas <code>DataFrame</code>. This is a general function that we
will use multiple times as we build different queries so we want to
write it once and then call the function rather than having to copy and
paste the code over and over again.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="kw">def</span> make_dataframe(table):</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>    <span class="co">"""Transform coordinates from ICRS to GD-1 frame.</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a><span class="co">    table: Astropy Table</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a><span class="co">    returns: Pandas DataFrame</span></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>    <span class="co">#Create a SkyCoord object with the coordinates and proper motions</span></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>    <span class="co"># in the input table</span></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>    skycoord <span class="op">=</span> SkyCoord(</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>               ra<span class="op">=</span>table[<span class="st">'ra'</span>], </span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>               dec<span class="op">=</span>table[<span class="st">'dec'</span>],</span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>               pm_ra_cosdec<span class="op">=</span>table[<span class="st">'pmra'</span>],</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>               pm_dec<span class="op">=</span>table[<span class="st">'pmdec'</span>], </span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>               distance<span class="op">=</span><span class="dv">8</span><span class="op">*</span>u.kpc, </span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>               radial_velocity<span class="op">=</span><span class="dv">0</span><span class="op">*</span>u.km<span class="op">/</span>u.s)</span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>    <span class="co"># Define the GD-1 reference frame</span></span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>    gd1_frame <span class="op">=</span> GD1Koposov10()</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" tabindex="-1"></a>    <span class="co"># Transform input coordinates to the GD-1 reference frame</span></span>
<span id="cb43-22"><a href="#cb43-22" tabindex="-1"></a>    transformed <span class="op">=</span> skycoord.transform_to(gd1_frame)</span>
<span id="cb43-23"><a href="#cb43-23" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" tabindex="-1"></a>    <span class="co"># Correct GD-1 coordinates for solar system motion around galactic center</span></span>
<span id="cb43-25"><a href="#cb43-25" tabindex="-1"></a>    skycoord_gd1 <span class="op">=</span> reflex_correct(transformed)</span>
<span id="cb43-26"><a href="#cb43-26" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" tabindex="-1"></a>    <span class="co">#Add GD-1 reference frame columns for coordinates and proper motions</span></span>
<span id="cb43-28"><a href="#cb43-28" tabindex="-1"></a>    table[<span class="st">'phi1'</span>] <span class="op">=</span> skycoord_gd1.phi1</span>
<span id="cb43-29"><a href="#cb43-29" tabindex="-1"></a>    table[<span class="st">'phi2'</span>] <span class="op">=</span> skycoord_gd1.phi2</span>
<span id="cb43-30"><a href="#cb43-30" tabindex="-1"></a>    table[<span class="st">'pm_phi1'</span>] <span class="op">=</span> skycoord_gd1.pm_phi1_cosphi2</span>
<span id="cb43-31"><a href="#cb43-31" tabindex="-1"></a>    table[<span class="st">'pm_phi2'</span>] <span class="op">=</span> skycoord_gd1.pm_phi2</span>
<span id="cb43-32"><a href="#cb43-32" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" tabindex="-1"></a>    <span class="co"># Create DataFrame</span></span>
<span id="cb43-34"><a href="#cb43-34" tabindex="-1"></a>    df <span class="op">=</span> table.to_pandas()</span>
<span id="cb43-35"><a href="#cb43-35" tabindex="-1"></a></span>
<span id="cb43-36"><a href="#cb43-36" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre>
</div>
<p>Here is how we use the function:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>results_df <span class="op">=</span> make_dataframe(polygon_results)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="saving-the-dataframe">Saving the DataFrame<a class="anchor" aria-label="anchor" href="#saving-the-dataframe"></a></h2>
<hr class="half-width"><p>At this point we have run a successful query and combined the results
into a single <code>DataFrame</code>. This is a good time to save the
data.</p>
<p>To save a Pandas <code>DataFrame</code>, one option is to convert it
to an Astropy <code>Table</code>, like this:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="im">from</span> astropy.table <span class="im">import</span> Table</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>results_table <span class="op">=</span> Table.from_pandas(results_df)</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a><span class="bu">type</span>(results_table)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.table.table.Table</span></span></code></pre>
</div>
<p>Then we could write the <code>Table</code> to a FITS file, as we did
in the previous lesson.</p>
<p>But, like Astropy, Pandas provides functions to write DataFrames in
other formats; to see what they are <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" class="external-link">find
the functions here that begin with <code>to_</code></a>.</p>
<p>One of the best options is HDF5, which is Version 5 of <a href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format" class="external-link">Hierarchical
Data Format</a>.</p>
<p>HDF5 is a binary format, so files are small and fast to read and
write (like FITS, but unlike XML).</p>
<p>An HDF5 file is similar to an SQL database in the sense that it can
contain more than one table, although in HDF5 vocabulary, a table is
called a Dataset. (<a href="https://www.stsci.edu/itt/review/dhb_2011/Intro/intro_ch23.html" class="external-link">Multi-extension
FITS files</a> can also contain more than one table.)</p>
<p>And HDF5 stores the metadata associated with the table, including
column names, row labels, and data types (like FITS).</p>
<p>Finally, HDF5 is a cross-language standard, so if you write an HDF5
file with Pandas, you can read it back with many other software tools
(more than FITS).</p>
<p>We can write a Pandas <code>DataFrame</code> to an HDF5 file like
this:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'gd1_data.hdf'</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>results_df.to_hdf(filename, <span class="st">'results_df'</span>, mode<span class="op">=</span><span class="st">'w'</span>)</span></code></pre>
</div>
<p>Because an HDF5 file can contain more than one Dataset, we have to
provide a name, or “key”, that identifies the Dataset in the file.</p>
<p>We could use any string as the key, but it is generally a good
practice to use a descriptive name (just like your
<code>DataFrame</code> variable name) so we will give the Dataset in the
file the same name (key) as the <code>DataFrame</code>.</p>
<p>By default, writing a <code>DataFrame</code> appends a new dataset to
an existing HDF5 file. We will use the argument <code>mode='w'</code> to
overwrite the file if it already exists rather than append another
dataset to it.</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>In this episode, we re-loaded the Gaia data we saved from a previous
query.</p>
<p>We transformed the coordinates and proper motion from ICRS to a frame
aligned with the orbit of GD-1, stored the results in a Pandas
<code>DataFrame</code>, and visualized them.</p>
<p>We combined all of these steps into a single function that we can
reuse in the future to go straight from the output of a query with
object coordinates in the ICRS reference frame directly to a Pandas
DataFrame that includes object coordinates in the GD-1 reference
frame.</p>
<p>We saved our results to an HDF5 file which we can use to restart the
analysis from this stage or verify our results at some future time.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>When you make a scatter plot, adjust the size of the markers and
their transparency so the figure is not overplotted; otherwise it can
misrepresent the data badly.</li>
<li>For simple scatter plots in Matplotlib, <code>plot</code> is faster
than <code>scatter</code>.</li>
<li>An Astropy <code>Table</code> and a Pandas <code>DataFrame</code>
are similar in many ways and they provide many of the same functions.
They have pros and cons, but for many projects, either one would be a
reasonable choice.</li>
<li>To store data from a Pandas <code>DataFrame</code>, a good option is
an HDF5 file, which can contain multiple Datasets (we’ll dig in more in
the Join lesson).</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-coords.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="04-motion.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-coords.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Coordinate
        </a>
        <a class="chapter-link float-end" href="04-motion.html" rel="next">
          Next: Plotting and Pandas...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/03-transform.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/astronomy-python/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/astronomy-python/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/astronomy-python/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://datacarpentry.github.io/astronomy-python/03-transform.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Plotting and Tabular Data",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/astronomy-python/03-transform.html",
  "identifier": "https://datacarpentry.github.io/astronomy-python/03-transform.html",
  "dateCreated": "2020-05-11",
  "dateModified": "2024-03-08",
  "datePublished": "2025-09-23"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

