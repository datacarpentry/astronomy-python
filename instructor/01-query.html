<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Foundations of Astronomical Data Science: Basic Queries</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/dc/favicon-16x16.png"><link rel="manifest" href="../favicons/dc/site.webmanifest"><link rel="mask-icon" href="../favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="../assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../01-query.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Foundations of Astronomical Data Science
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Foundations of Astronomical Data Science
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="calculating_MIST_isochrone.html">Making the Isochrone DataFrame</a></li><li><a class="dropdown-item" href="link-list.html">Link List</a></li><li><a class="dropdown-item" href="prereqs.html">Prerequisites</a></li><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Foundations of Astronomical Data Science
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 0%" class="percentage">
    0%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 0%" aria-valuenow="0" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../01-query.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        1. Basic Queries
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#query-language">Query Language</a></li>
<li><a href="#using-jupyter">Using Jupyter</a></li>
<li><a href="#connecting-to-gaia">Connecting to Gaia</a></li>
<li><a href="#databases-and-tables">Databases and Tables</a></li>
<li><a href="#columns">Columns</a></li>
<li><a href="#writing-queries">Writing queries</a></li>
<li><a href="#asynchronous-queries">Asynchronous queries</a></li>
<li><a href="#operators">Operators</a></li>
<li><a href="#formatting-queries">Formatting queries</a></li>
<li><a href="#summary">Summary</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-coords.html">2. Coordinate Transformations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-transform.html">3. Plotting and Tabular Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-motion.html">4. Plotting and Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-select.html">5. Transform and Select</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-join.html">6. Join</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-photo.html">7. Photometry</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-plot.html">8. Visualization</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <li><a href="calculating_MIST_isochrone.html">Making the Isochrone DataFrame</a></li><li><a href="link-list.html">Link List</a></li><li><a href="prereqs.html">Prerequisites</a></li><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/02-coords.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="../instructor/02-coords.html" rel="next">
          Next: Coordinate...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Basic Queries</h1>
        <p>Last updated on 2023-05-15 |

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/01-query.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we select and download the data we want from the Gaia
server?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Compose a basic query in ADQL/SQL.</li>
<li>Use queries to explore a database and its tables.</li>
<li>Use queries to download data.</li>
<li>Develop, test, and debug a query incrementally.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>As a running example, we will replicate parts of the analysis in the
paper, “<a href="https://arxiv.org/abs/1805.00425" class="external-link">Off the beaten path:
Gaia reveals GD-1 stars outside of the main stream</a>” by Adrian
Price-Whelan and Ana Bonaca.</p>
<div id="outline" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<span class="callout-header">Checklist</span>
<div id="outline" class="callout-inner">
<h3 class="callout-title">Outline</h3>
<div class="callout-content">
<p>This episode demonstrates the steps for selecting and downloading
data from the Gaia Database:</p>
<ol style="list-style-type: decimal"><li><p>First we will make a connection to the Gaia server,</p></li>
<li><p>We will explore information about the database and the tables it
contains,</p></li>
<li><p>We will write a query and send it to the server, and
finally</p></li>
<li><p>We will download the response from the server.</p></li>
</ol></div>
</div>
</div>
<section><h2 class="section-heading" id="query-language">Query Language<a class="anchor" aria-label="anchor" href="#query-language"></a></h2>
<hr class="half-width"><p>In order to select data from a database, you need to compose a query,
which is a program written in a “query language”. The query language we
will use is ADQL, which stands for “Astronomical Data Query
Language”.</p>
<p>ADQL is a dialect of <a href="https://en.wikipedia.org/wiki/SQL" class="external-link">SQL</a> (Structured Query
Language), which is by far the most commonly used query language. Almost
everything you will learn about ADQL also works in SQL.</p>
<p><a href="https://www.ivoa.net/documents/ADQL/20180112/PR-ADQL-2.1-20180112.html" class="external-link">The
reference manual for ADQL is here</a>. But you might find it easier to
learn from <a href="https://www.gaia.ac.uk/data/gaia-data-release-1/adql-cookbook" class="external-link">this
ADQL Cookbook</a>.</p>
</section><section><h2 class="section-heading" id="using-jupyter">Using Jupyter<a class="anchor" aria-label="anchor" href="#using-jupyter"></a></h2>
<hr class="half-width"><p>If you have not worked with Jupyter notebooks before, you might start
with <a href="https://jupyter.org/try" class="external-link">the tutorial on from Jupyter.org
called “Try Classic Notebook”</a>, or <a href="https://www.dataquest.io/blog/jupyter-notebook-tutorial/" class="external-link">this
tutorial from DataQuest</a>.</p>
<p>There are two environments you can use to write and run
notebooks:</p>
<ul><li><p>“Jupyter Notebook” is the original, and</p></li>
<li><p>“Jupyter Lab” is a newer environment with more features.</p></li>
</ul><p>For this lesson, you can use either one.</p>
<p>Here are the most important things to know about running a Jupyter
notebook:</p>
<ol style="list-style-type: decimal"><li><p>Notebooks are made up of code cells and text cells (and a few
other less common kinds). Code cells contain code; text cells contain
explanatory text written in <a href="https://www.markdownguide.org/" class="external-link">Markdown</a>.</p></li>
<li><p>To run a code cell, click the cell to select it and press
Shift-Enter. The output of the code should appear below the
cell.</p></li>
<li><p>In general, notebooks only run correctly if you run every code
cell in order from top to bottom. If you run cells out of order, you are
likely to get errors.</p></li>
<li><p>You can modify existing cells, but then you have to run them
again to see the effect.</p></li>
<li><p>You can add new cells, but you need to be careful about the order
you run them in.</p></li>
<li><p>If you have added or modified cells, and the behavior of the
notebook seems strange, you can restart the “kernel”, which clears all
of the variables and functions you have defined, and run the cells again
from the beginning.</p></li>
</ol><ul><li><p>If you are using Jupyter Notebook, open the <code>Kernel</code>
menu and select “Restart and Run All”.</p></li>
<li><p>In Jupyter Lab, open the <code>Kernel</code> menu and select
“Restart Kernel and Run All Cells”.</p></li>
</ul><p>Before you continue with this lesson, you might want to explore the
other menus and the toolbar to see what else you can do.</p>
</section><section><h2 class="section-heading" id="connecting-to-gaia">Connecting to Gaia<a class="anchor" aria-label="anchor" href="#connecting-to-gaia"></a></h2>
<hr class="half-width"><p>The library we will use to get Gaia data is <a href="https://astroquery.readthedocs.io/en/latest/" class="external-link">Astroquery</a>.
Astroquery provides <code>Gaia</code>, which is an <a href="https://astroquery.readthedocs.io/en/latest/gaia/gaia.html" class="external-link">object
that represents a connection to the Gaia database</a>.</p>
<p>We can connect to the Gaia database like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> astroquery.gaia <span class="im">import</span> Gaia</span></code></pre>
</div>
<div id="old-versions-of-astroquery-output" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="old-versions-of-astroquery-output" class="callout-inner">
<h3 class="callout-title">Old versions of astroquery output</h3>
<div class="callout-content">
<p>if you are using a version of astroquery that’s older than v0.4.4,
you may see this output</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Created TAP+ (v1.2.1) - Connection:
	Host: gea.esac.esa.int
	Use HTTPS: True
	Port: 443
	SSL Port: 443
Created TAP+ (v1.2.1) - Connection:
	Host: geadata.esac.esa.int
	Use HTTPS: True
	Port: 443
	SSL Port: 443</code></pre>
</div>
</div>
</div>
</div>
<p>This import statement creates a <a href="https://www.ivoa.net/documents/TAP/" class="external-link">TAP+</a> connection; TAP
stands for “Table Access Protocol”, which is a network protocol for
sending queries to the database and getting back the results.</p>
</section><section><h2 class="section-heading" id="databases-and-tables">Databases and Tables<a class="anchor" aria-label="anchor" href="#databases-and-tables"></a></h2>
<hr class="half-width"><p>What is a database? Most generally, it can be any collection of data,
but when we are talking about ADQL or SQL:</p>
<ul><li><p>A database is a collection of one or more named tables.</p></li>
<li><p>Each table is a 2-D array with one or more named columns of
data.</p></li>
</ul><p>We can use <code>Gaia.load_tables</code> to get the names of the
tables in the Gaia database. With the option
<code>only_names=True</code>, it loads information about the tables,
called “metadata”, but not the data itself.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>tables <span class="op">=</span> Gaia.load_tables(only_names<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO: Retrieving tables... [astroquery.utils.tap.core]
INFO: Parsing tables... [astroquery.utils.tap.core]
INFO: Done. [astroquery.utils.tap.core]</code></pre>
</div>
<p>The following <code>for</code> loop prints the names of the
tables.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">for</span> table <span class="kw">in</span> tables:</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="bu">print</span>(table.name)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>external.apassdr9
external.gaiadr2_geometric_distance
external.gaiaedr3_distance
external.galex_ais
external.ravedr5_com
external.ravedr5_dr5
external.ravedr5_gra
external.ravedr5_on
external.sdssdr13_photoprimary
external.skymapperdr1_master
external.skymapperdr2_master
[Output truncated]</code></pre>
</div>
<p>So that is a lot of tables. The ones we will use are:</p>
<ul><li><p><code>gaiadr2.gaia_source</code>, which contains Gaia data from
<a href="https://www.cosmos.esa.int/web/gaia/data-release-2" class="external-link">data
release 2</a>,</p></li>
<li><p><code>gaiadr2.panstarrs1_original_valid</code>, which contains
the photometry data we will use from PanSTARRS, and</p></li>
<li><p><code>gaiadr2.panstarrs1_best_neighbour</code>, which we will use
to cross-match each star observed by Gaia with the same star observed by
PanSTARRS.</p></li>
</ul><p>We can use <code>load_table</code> (not <code>load_tables</code>) to
get the metadata for a single table. The name of this function is
misleading, because it only downloads metadata, not the contents of the
table.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>table_metadata <span class="op">=</span> Gaia.load_table(<span class="st">'gaiadr2.gaia_source'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>table_metadata</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Retrieving table 'gaiadr2.gaia_source'
Parsing table 'gaiadr2.gaia_source'...
Done.

&lt;astroquery.utils.tap.model.taptable.TapTableMeta at 0x7f50edd2aeb0&gt;</code></pre>
</div>
<p>Jupyter shows that the result is an object of type
<code>TapTableMeta</code>, but it does not display the contents.</p>
<p>To see the metadata, we have to print the object.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="bu">print</span>(table_metadata)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TAP Table name: gaiadr2.gaiadr2.gaia_source
Description: This table has an entry for every Gaia observed source as listed in the
Main Database accumulating catalogue version from which the catalogue
release has been generated. It contains the basic source parameters,
that is only final data (no epoch data) and no spectra (neither final
nor epoch).
Num. columns: 95</code></pre>
</div>
</section><section><h2 class="section-heading" id="columns">Columns<a class="anchor" aria-label="anchor" href="#columns"></a></h2>
<hr class="half-width"><p>The following loop prints the names of the columns in the table.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> table_metadata.columns:</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="bu">print</span>(column.name)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>solution_id
designation
source_id
random_index
ref_epoch
ra
ra_error
dec
dec_error
parallax
parallax_error
[Output truncated]</code></pre>
</div>
<p>You can probably infer what many of these columns are by looking at
the names, but you should resist the temptation to guess. To find out
what the columns mean, <a href="https://gea.esac.esa.int/archive/documentation/GDR2/Gaia_archive/chap_datamodel/sec_dm_main_tables/ssec_dm_gaia_source.html" class="external-link">read
the documentation</a>.</p>
<div id="exercise-2-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-2-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (2 minutes)</h3>
<div class="callout-content">
<p>One of the other tables we will use is
<code>gaiadr2.panstarrs1_original_valid</code>. Use
<code>load_table</code> to get the metadata for this table. How many
columns are there and what are their names?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>panstarrs_metadata <span class="op">=</span> Gaia.load_table(<span class="st">'gaiadr2.panstarrs1_original_valid'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="bu">print</span>(panstarrs_metadata)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Retrieving table 'gaiadr2.panstarrs1_original_valid'
TAP Table name: gaiadr2.gaiadr2.panstarrs1_original_valid
Description: The Panoramic Survey Telescope and Rapid Response System (Pan-STARRS) is
a system for wide-field astronomical imaging developed and operated by
the Institute for Astronomy at the University of Hawaii. Pan-STARRS1

[Output truncated]

Catalogue curator:
SSDC - ASI Space Science Data Center
https://www.ssdc.asi.it/
Num. columns: 26</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> panstarrs_metadata.columns:</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    <span class="bu">print</span>(column.name)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">obj_name</span></span>
<span><span class="va">obj_id</span></span>
<span><span class="va">ra</span></span>
<span><span class="va">dec</span></span>
<span><span class="va">ra_error</span></span>
<span><span class="va">dec_error</span></span>
<span><span class="va">epoch_mean</span></span>
<span><span class="va">g_mean_psf_mag</span></span>
<span><span class="va">g_mean_psf_mag_error</span></span>
<span><span class="va">g_flags</span></span>
<span><span class="va">r_mean_psf_mag</span></span>
<span><span class="va">r_mean_psf_mag_error</span></span>
<span><span class="va">r_flags</span></span>
<span><span class="va">i_mean_psf_mag</span></span>
<span><span class="va">i_mean_psf_mag_error</span></span>
<span><span class="va">i_flags</span></span>
<span><span class="va">z_mean_psf_mag</span></span>
<span><span class="va">z_mean_psf_mag_error</span></span>
<span><span class="va">z_flags</span></span>
<span><span class="va">y_mean_psf_mag</span></span>
<span><span class="va">y_mean_psf_mag_error</span></span>
<span><span class="va">y_flags</span></span>
<span><span class="va">n_detections</span></span>
<span><span class="va">zone_id</span></span>
<span><span class="va">obj_info_flag</span></span>
<span><span class="va">quality_flag</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="writing-queries">Writing queries<a class="anchor" aria-label="anchor" href="#writing-queries"></a></h2>
<hr class="half-width"><p>You might be wondering how we download these tables. With tables this
big, you generally don’t. Instead, you use queries to select only the
data you want.</p>
<p>A query is a program written in a query language like SQL. For the
Gaia database, the query language is a dialect of SQL called ADQL.</p>
<p>Here’s an example of an ADQL query.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>query1 <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="st">source_id, ra, dec, parallax </span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<div id="triple-quotes-strings" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="triple-quotes-strings" class="callout-inner">
<h3 class="callout-title">Triple-quotes strings</h3>
<div class="callout-content">
<p>We use a <a href="https://docs.python.org/3/tutorial/introduction.html#strings" class="external-link">triple-quoted
string</a> here so we can include line breaks in the query, which makes
it easier to read.</p>
</div>
</div>
</div>
<p>The words in uppercase are ADQL keywords:</p>
<ul><li><p><code>SELECT</code> indicates that we are selecting data (as
opposed to adding or modifying data).</p></li>
<li><p><code>TOP</code> indicates that we only want the first 10 rows of
the table, which is useful for testing a query before asking for all of
the data.</p></li>
<li><p><code>FROM</code> specifies which table we want data
from.</p></li>
</ul><p>The third line is a list of column names, indicating which columns we
want.</p>
<p>In this example, the keywords are capitalized and the column names
are lowercase. This is a common style, but it is not required. ADQL and
SQL are not case-sensitive.</p>
<p>Also, the query is broken into multiple lines to make it more
readable. This is a common style, but not required. Line breaks don’t
affect the behavior of the query.</p>
<p>To run this query, we use the <code>Gaia</code> object, which
represents our connection to the Gaia database, and invoke
<code>launch_job</code>:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>job1 <span class="op">=</span> Gaia.launch_job(query1)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>job1</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;astroquery.utils.tap.model.job.Job at 0x7f50edd2adc0&gt;</code></pre>
</div>
<p>The result is an object that represents the job running on a Gaia
server.</p>
<p>If you print it, it displays metadata for the forthcoming
results.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="bu">print</span>(job1)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
   name    dtype  unit                            description                             n_bad
--------- ------- ---- ------------------------------------------------------------------ -----
source_id   int64      Unique source identifier (unique within a particular Data Release)     0
       ra float64  deg                                                    Right ascension     0
      dec float64  deg                                                        Declination     0
 parallax float64  mas                                                           Parallax     2
Jobid: None
Phase: COMPLETED
Owner: None
Output file: sync_20210315090602.xml.gz
[Output truncated]</code></pre>
</div>
<p>Don’t worry about <code>Results: None</code>. That does not actually
mean there are no results.</p>
<p>However, <code>Phase: COMPLETED</code> indicates that the job is
complete, so we can get the results like this:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>results1 <span class="op">=</span> job1.get_results()</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="bu">type</span>(results1)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.table.table.Table</span></span></code></pre>
</div>
<p>The <code>type</code> function indicates that the result is an <a href="https://docs.astropy.org/en/stable/table/" class="external-link">Astropy Table</a>.</p>
<div id="repetition" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="repetition" class="callout-inner">
<h3 class="callout-title">Repetition</h3>
<div class="callout-content">
<p>Why is <code>table</code> repeated three times? The first is the name
of the module, the second is the name of the submodule, and the third is
the name of the class. Most of the time we only care about the last one.
It’s like the Linnean name for the Western lowland gorilla, which is
<em>Gorilla gorilla gorilla</em>.</p>
</div>
</div>
</div>
<p>An Astropy <code>Table</code> is similar to a table in an SQL
database except:</p>
<ul><li><p>SQL databases are stored on disk drives, so they are persistent;
that is, they “survive” even if you turn off the computer. An Astropy
<code>Table</code> is stored in memory; it disappears when you turn off
the computer (or shut down your Jupyter notebook).</p></li>
<li><p>SQL databases are designed to process queries. An Astropy
<code>Table</code> can perform some query-like operations, like
selecting columns and rows. But these operations use Python syntax, not
SQL.</p></li>
</ul><p>Jupyter knows how to display the contents of a
<code>Table</code>.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>results1</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
     source_id              ra                 dec               parallax
                           deg                 deg                 mas
       int64             float64             float64             float64
------------------- ------------------ ------------------- --------------------
5887983246081387776   227.978818386372  -53.64996962450103   1.0493172163332998
5887971250213117952 228.32280834041364  -53.66270726203726  0.29455652682279093
5887991866047288704  228.1582047014091 -53.454724911639794  -0.5789179941669236
5887968673232040832 228.07420888099884   -53.8064612895961  0.41030970779603076
5887979844465854720 228.42547805195946  -53.48882284470035 -0.23379683441525864
5887978607515442688 228.23831627636855  -53.56328249482688  -0.9252161956789068
[Output truncated]</code></pre>
</div>
<p>Each column has a name, units, and a data type.</p>
<p>For example, the units of <code>ra</code> and <code>dec</code> are
degrees, and their data type is <code>float64</code>, which is a 64-bit
<a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic" class="external-link">floating-point
number</a>, used to store measurements with a fraction part.</p>
<p>This information comes from the Gaia database, and has been stored in
the Astropy <code>Table</code> by Astroquery.</p>
<div id="exercise-3-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-3-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (3 minutes)</h3>
<div class="callout-content">
<p>Read <a href="https://gea.esac.esa.int/archive/documentation/GDR2/Gaia_archive/chap_datamodel/sec_dm_main_tables/ssec_dm_gaia_source.html" class="external-link">the
documentation</a> of this table and choose a column that looks
interesting to you. Add the column name to the query and run it again.
What are the units of the column you selected? What is its data
type?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>For example, we can add radial_velocity : Radial velocity (double,
Velocity[km/s] ) - Spectroscopic radial velocity in the solar
barycentric reference frame. The radial velocity provided is the median
value of the radial velocity measurements at all epochs.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>query1_with_rv <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="st">source_id, ra, dec, parallax, radial_velocity</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>job1_with_rv <span class="op">=</span> Gaia.launch_job(query1_with_rv)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>results1_with_rv <span class="op">=</span> job1_with_rv.get_results()</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>results1_with_rv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     source_id              ra         ...       parallax       radial_velocity
                           deg         ...         mas               km / s
------------------- ------------------ ... -------------------- ---------------
5800603716991968256 225.13905251174302 ...   0.5419737483675161              --
5800592790577127552 224.30113911598448 ...  -0.6369101209622813              --
5800601273129497856 225.03260084885449 ...  0.27554460953986526              --
[Output truncated]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="asynchronous-queries">Asynchronous queries<a class="anchor" aria-label="anchor" href="#asynchronous-queries"></a></h2>
<hr class="half-width"><p><code>launch_job</code> asks the server to run the job
“synchronously”, which normally means it runs immediately. But
synchronous jobs are limited to 2000 rows. For queries that return more
rows, you should run “asynchronously”, which mean they might take longer
to get started.</p>
<p>If you are not sure how many rows a query will return, you can use
the SQL command <code>COUNT</code> to find out how many rows are in the
result without actually returning them. We will see an example in the
next lesson.</p>
<p>The results of an asynchronous query are stored in a file on the
server, so you can start a query and come back later to get the results.
For anonymous users, files are kept for three days.</p>
<p>As an example, let us try a query that is similar to
<code>query1</code>, with these changes:</p>
<ul><li><p>It selects the first 3000 rows, so it is bigger than we should
run synchronously.</p></li>
<li><p>It selects two additional columns, <code>pmra</code> and
<code>pmdec</code>, which are proper motions along the axes of
<code>ra</code> and <code>dec</code>.</p></li>
<li><p>It uses a new keyword, <code>WHERE</code>.</p></li>
</ul><div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>query2 <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="st">TOP 3000</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="st">source_id, ra, dec, pmra, pmdec, parallax</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>A <code>WHERE</code> clause indicates which rows we want; in this
case, the query selects only rows “where” <code>parallax</code> is less
than 1. This has the effect of selecting stars with relatively low
parallax, which are farther away. We’ll use this clause to exclude
nearby stars that are unlikely to be part of GD-1.</p>
<p><code>WHERE</code> is one of the most common clauses in ADQL/SQL, and
one of the most useful, because it allows us to download only the rows
we need from the database.</p>
<p>We use <code>launch_job_async</code> to submit an asynchronous
query.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>job2 <span class="op">=</span> Gaia.launch_job_async(query2)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>job2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO: Query finished. [astroquery.utils.tap.core]

&lt;astroquery.utils.tap.model.job.Job at 0x7f50edd40f40&gt;</code></pre>
</div>
<p>And here are the results.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>results2 <span class="op">=</span> job2.get_results()</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>results2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=3000&gt;
     source_id              ra         ...       parallax       radial_velocity
                           deg         ...         mas               km / s
       int64             float64       ...       float64            float64
------------------- ------------------ ... -------------------- ---------------
5895270396817359872 213.08433715252883 ...    2.041947005434917              --
5895272561481374080  213.2606587905109 ...  0.15693467895110133              --
5895247410183786368 213.38479712976664 ... -0.19017525742552605              --
5895249226912448000 213.41587389088238 ...                   --              --
5895261875598904576  213.5508930114549 ... -0.29471722363529257              --
5895258302187834624 213.87631129557286 ...   0.6468437015289753              --
[Output truncated]</code></pre>
</div>
<p>You might notice that some values of <code>parallax</code> are
negative. As <a href="https://www.cosmos.esa.int/web/gaia/archive-tips#negative%20parallax" class="external-link">this
FAQ explains</a>, “Negative parallaxes are caused by errors in the
observations.” They have “no physical meaning,” but they can be a
“useful diagnostic on the quality of the astrometric solution.”</p>
<div id="different-results" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="different-results" class="callout-inner">
<h3 class="callout-title">Different results</h3>
<div class="callout-content">
<p>Your results for this query may differ from the Instructor’s. This is
because <code>TOP 3000</code> returns 3000 results, but those results
are not organized in any particular way.</p>
</div>
</div>
</div>
<div id="exercise-5-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-5-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (5 minutes)</h3>
<div class="callout-content">
<p>The clauses in a query have to be in the right order. Go back and
change the order of the clauses in <code>query2</code> and run it again.
The modified query should fail, but notice that you don’t get much
useful debugging information.</p>
<p>For this reason, developing and debugging ADQL queries can be really
hard. A few suggestions that might help:</p>
<ul><li><p>Whenever possible, start with a working query, either an example
you find online or a query you have used in the past.</p></li>
<li><p>Make small changes and test each change before you
continue.</p></li>
<li><p>While you are debugging, use <code>TOP</code> to limit the number
of rows in the result. That will make each test run faster, which
reduces your development time.</p></li>
<li><p>Launching test queries synchronously might make them start
faster, too.</p></li>
</ul></div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>In this example, the WHERE clause is in the wrong place.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>query2_erroneous = """SELECT
TOP 3000
WHERE parallax &lt; 1
source_id, ref_epoch, ra, dec, parallax
FROM gaiadr2.gaia_source
"""</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="operators">Operators<a class="anchor" aria-label="anchor" href="#operators"></a></h2>
<hr class="half-width"><p>In a <code>WHERE</code> clause, you can use any of the <a href="https://www.w3schools.com/sql/sql_operators.asp" class="external-link">SQL comparison
operators</a>; here are the most common ones:</p>
<table class="table"><thead><tr class="header"><th>Symbol</th>
<th align="left">Operation</th>
</tr></thead><tbody><tr class="odd"><td><code>&gt;</code></td>
<td align="left">greater than</td>
</tr><tr class="even"><td><code>&lt;</code></td>
<td align="left">less than</td>
</tr><tr class="odd"><td><code>&gt;=</code></td>
<td align="left">greater than or equal</td>
</tr><tr class="even"><td><code>&lt;=</code></td>
<td align="left">less than or equal</td>
</tr><tr class="odd"><td><code>=</code></td>
<td align="left">equal</td>
</tr><tr class="even"><td>
<code>!=</code> or <code>&lt;&gt;</code>
</td>
<td align="left">not equal</td>
</tr></tbody></table><p>Most of these are the same as Python, but some are not. In
particular, notice that the equality operator is <code>=</code>, not
<code>==</code>. Be careful to keep your Python out of your ADQL!</p>
<p>You can combine comparisons using the logical operators:</p>
<ul><li>AND: true if both comparisons are true</li>
<li>OR: true if either or both comparisons are true</li>
</ul><p>Finally, you can use <code>NOT</code> to invert the result of a
comparison.</p>
<div id="exercise-5-minutes-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-5-minutes-1" class="callout-inner">
<h3 class="callout-title">Exercise (5 minutes)</h3>
<div class="callout-content">
<p><a href="https://www.w3schools.com/sql/sql_operators.asp" class="external-link">Read about
SQL operators here</a> and then modify the previous query to select rows
where <code>bp_rp</code> is between <code>-0.75</code> and
<code>2</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Here is a solution using <code>&gt;</code> and <code>&lt;</code>
operators:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>query2_sol1 <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="st">source_id, ref_epoch, ra, dec, parallax</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1 </span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="st">  AND bp_rp &gt; -0.75 AND bp_rp &lt; 2</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>And here is a solution using the <code>BETWEEN</code> operator:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>query2_sol2 <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="st">source_id, ref_epoch, ra, dec, parallax</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1 </span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="st">  AND bp_rp BETWEEN -0.75 AND 2</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p><code>bp_rp</code> contains BP-RP color, which is the difference
between two other columns, <code>phot_bp_mean_mag</code> and
<code>phot_rp_mean_mag</code>. You can <a href="https://gea.esac.esa.int/archive/documentation/GDR2/Gaia_archive/chap_datamodel/sec_dm_main_tables/ssec_dm_gaia_source.html" class="external-link">read
about this variable here</a>.</p>
<p>This <a href="https://sci.esa.int/web/gaia/-/60198-gaia-hertzsprung-russell-diagram" class="external-link">Hertzsprung-Russell
diagram</a> shows the BP-RP color and luminosity of stars in the Gaia
catalog (Copyright: ESA/Gaia/DPAC, CC BY-SA 3.0 IGO).</p>
<figure><img src="../fig/Gaia-HR-diagram.jpeg" alt="Hertzsprung-Russell diagram of BP-RP color versus luminosity." class="figure mx-auto d-block"></figure><p>Selecting stars with <code>bp-rp</code> less than 2 excludes many <a href="https://xkcd.com/2360/" class="external-link">class M dwarf stars</a>, which are low
temperature, low luminosity. A star like that at GD-1’s distance would
be hard to detect, so if it is detected, it is more likely to be in the
foreground.</p>
</section><section><h2 class="section-heading" id="formatting-queries">Formatting queries<a class="anchor" aria-label="anchor" href="#formatting-queries"></a></h2>
<hr class="half-width"><p>The queries we have written so far are string “literals”, meaning
that the entire string is part of the program. But writing queries
yourself can be slow, repetitive, and error-prone.</p>
<p>It is often better to write Python code that assembles a query for
you. One useful tool for that is the <a href="https://www.w3schools.com/python/ref_string_format.asp" class="external-link">string
<code>format</code> method</a>.</p>
<p>As an example, we will divide the previous query into two parts; a
list of column names and a “base” for the query that contains everything
except the column names.</p>
<p>Here is the list of columns we will select.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>columns <span class="op">=</span> <span class="st">'source_id, ra, dec, pmra, pmdec, parallax'</span></span></code></pre>
</div>
<p>And here is the base. It is a string that contains at least one
format specifier in curly brackets (braces).</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>query3_base <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="st">TOP 10 </span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="sc">{columns}</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1</span></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="st">  AND bp_rp BETWEEN -0.75 AND 2</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>This base query contains one format specifier,
<code>{columns}</code>, which is a placeholder for the list of column
names we will provide.</p>
<p>To assemble the query, we invoke <code>format</code> on the base
string and provide a keyword argument that assigns a value to
<code>columns</code>.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>query3 <span class="op">=</span> query3_base.<span class="bu">format</span>(columns<span class="op">=</span>columns)</span></code></pre>
</div>
<p>In this example, the variable that contains the column names and the
variable in the format specifier have the same name. That is not
required, but it is a common style.</p>
<p>The result is a string with line breaks. If you display it, the line
breaks appear as <code>\n</code>.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>query3</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'SELECT \nTOP 10 \nsource_id, ra, dec, pmra, pmdec, parallax\nFROM gaiadr2.gaia_source\nWHERE parallax &lt; 1\n  AND bp_rp BETWEEN -0.75 AND 2\n'</span></span></code></pre>
</div>
<p>But if you print it, the line breaks appear as line breaks.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="bu">print</span>(query3)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SELECT
TOP 10
source_id, ra, dec, pmra, pmdec, parallax
FROM gaiadr2.gaia_source
WHERE parallax &lt; 1
  AND bp_rp BETWEEN -0.75 AND 2</code></pre>
</div>
<p>Notice that the format specifier has been replaced with the value of
<code>columns</code>.</p>
<p>Let’s run it and see if it works:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>job3 <span class="op">=</span> Gaia.launch_job(query3)</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a><span class="bu">print</span>(job3)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
   name    dtype    unit                              description
--------- ------- -------- ------------------------------------------------------------------
source_id   int64          Unique source identifier (unique within a particular Data Release)
       ra float64      deg                                                    Right ascension
      dec float64      deg                                                        Declination
     pmra float64 mas / yr                         Proper motion in right ascension direction
    pmdec float64 mas / yr                             Proper motion in declination direction
 parallax float64      mas                                                           Parallax
Jobid: None
Phase: COMPLETED
Owner: None
[Output truncated]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>results3 <span class="op">=</span> job3.get_results()</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>results3</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
     source_id              ra         ...       parallax
                           deg         ...         mas
------------------- ------------------ ... -------------------
3031147124474711552 110.10540720349103 ... 0.47255775887968876
3031114276567648256 110.92831846731636 ... 0.41817219481822415
3031130872315906048 110.61072654450903 ...   0.178490206751036
3031128162192428544 110.78664993513391 ...  0.8412331482786942
3031140497346996736  110.0617759777779 ... 0.16993569795437397
3031111910043832576 110.84459425332385 ...  0.4668864606089576
[Output truncated]</code></pre>
</div>
<div id="exercise-10-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-10-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (10 minutes)</h3>
<div class="callout-content">
<p>This query always selects sources with <code>parallax</code> less
than 1. But suppose you want to take that upper bound as an input.</p>
<p>Modify <code>query3_base</code> to replace <code>1</code> with a
format specifier like <code>{max_parallax}</code>. Now, when you call
<code>format</code>, add a keyword argument that assigns a value to
<code>max_parallax</code>, and confirm that the format specifier gets
replaced with the value you provide.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>query_base_sol <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="sc">{columns}</span></span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; </span><span class="sc">{max_parallax}</span><span class="st"> AND </span></span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a><span class="st">bp_rp BETWEEN -0.75 AND 2</span></span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a>query_sol <span class="op">=</span> query_base_sol.<span class="bu">format</span>(columns<span class="op">=</span>columns,</span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a>                          max_parallax<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a><span class="bu">print</span>(query_sol)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>This episode has demonstrated the following steps:</p>
<ol style="list-style-type: decimal"><li><p>Making a connection to the Gaia server,</p></li>
<li><p>Exploring information about the database and the tables it
contains,</p></li>
<li><p>Writing a query and sending it to the server, and
finally</p></li>
<li><p>Downloading the response from the server as an Astropy
<code>Table</code>.</p></li>
</ol><p>In the next episode we will extend these queries to select a
particular region of the sky.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>If you can’t download an entire dataset (or it is not practical) use
queries to select the data you need.</li>
<li>Read the metadata and the documentation to make sure you understand
the tables, their columns, and what they mean.</li>
<li>Develop queries incrementally: start with something simple, test it,
and add a little bit at a time.</li>
<li>Use ADQL features like <code>TOP</code> and <code>COUNT</code> to
test before you run a query that might return a lot of data.</li>
<li>If you know your query will return fewer than 3000 rows, you can run
it synchronously. If it might return more than 3000 rows, you should run
it asynchronously.</li>
<li>ADQL and SQL are not case-sensitive. You don’t have to capitalize
the keywords, but it will make your code more readable.</li>
<li>ADQL and SQL don’t require you to break a query into multiple lines,
but it will make your code more readable.</li>
<li>Make each section of the notebook self-contained. Try not to use the
same variable name in more than one section.</li>
<li>Keep notebooks short. Look for places where you can break your
analysis into phases with one notebook per phase.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/02-coords.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="../instructor/02-coords.html" rel="next">
          Next: Coordinate...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/01-query.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/astronomy-python/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/astronomy-python/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/astronomy-python/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://datacarpentry.github.io/astronomy-python/instructor/01-query.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Basic Queries",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/astronomy-python/instructor/01-query.html",
  "identifier": "https://datacarpentry.github.io/astronomy-python/instructor/01-query.html",
  "dateCreated": "2020-05-11",
  "dateModified": "2023-05-15",
  "datePublished": "2025-08-12"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

