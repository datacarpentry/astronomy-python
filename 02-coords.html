<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Foundations of Astronomical Data Science: Coordinate Transformations</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/dc/favicon-16x16.png"><link rel="manifest" href="favicons/dc/site.webmanifest"><link rel="mask-icon" href="favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/02-coords.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Foundations of Astronomical Data Science
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Foundations of Astronomical Data Science
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Foundations of Astronomical Data Science
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 14%" class="percentage">
    14%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 14%" aria-valuenow="14" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/02-coords.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-query.html">1. Basic Queries</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Coordinate Transformations
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#working-with-units">Working with Units</a></li>
<li><a href="#selecting-a-region">Selecting a Region</a></li>
<li><a href="#getting-gd-1-data">Getting GD-1 Data</a></li>
<li><a href="#transforming-coordinates">Transforming coordinates</a></li>
<li><a href="#selecting-a-rectangle">Selecting a rectangle</a></li>
<li><a href="#defining-a-polygon">Defining a polygon</a></li>
<li><a href="#assembling-the-query">Assembling the query</a></li>
<li><a href="#saving-results">Saving results</a></li>
<li><a href="#summary">Summary</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-transform.html">3. Plotting and Tabular Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-motion.html">4. Plotting and Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-select.html">5. Transform and Select</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-join.html">6. Join</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-photo.html">7. Photometry</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-plot.html">8. Visualization</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-query.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="03-transform.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-query.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Basic Queries
        </a>
        <a class="chapter-link float-end" href="03-transform.html" rel="next">
          Next: Plotting and Tabular...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Coordinate Transformations</h1>
        <p>Last updated on 2025-02-03 |

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/02-coords.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do we transform celestial coordinates from one frame to another
and save a subset of the results in files?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Use Python string formatting to compose more complex ADQL
queries.</li>
<li>Work with coordinates and other quantities that have units.</li>
<li>Download the results of a query and store them in a file.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In the previous episode, we wrote ADQL queries and used them to
select and download data from the Gaia server. In this episode, we will
write a query to select stars from a particular region of the sky.</p>
<div id="outline" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="outline" class="callout-inner">
<h3 class="callout-title">Outline</h3>
<div class="callout-content">
<p>We’ll start with an example that does a “cone search”; that is, it
selects stars that appear in a circular region of the sky.</p>
<p>Then, to select stars in the vicinity of GD-1, we will:</p>
<ul><li><p>Use <code>Quantity</code> objects to represent measurements with
units.</p></li>
<li><p>Use <a href="https://www.astropy.org" class="external-link">Astropy</a> to convert
coordinates from one frame to another.</p></li>
<li><p>Use the ADQL keywords <code>POLYGON</code>,
<code>CONTAINS</code>, and <code>POINT</code> to select stars that fall
within a polygonal region.</p></li>
<li><p>Submit a query and download the results.</p></li>
<li><p>Store the results in a FITS file.</p></li>
</ul></div>
</div>
</div>
<section><h2 class="section-heading" id="working-with-units">Working with Units<a class="anchor" aria-label="anchor" href="#working-with-units"></a></h2>
<hr class="half-width"><p>The measurements we will work with are physical quantities, which
means that they have two parts, a value and a unit. For example, the
coordinate 30<sup>°</sup> has value 30 and its units are degrees.</p>
<p>Until recently, most scientific computation was done with values
only; units were left out of the program altogether, <a href="https://en.wikipedia.org/wiki/Mars_Climate_Orbiter#Cause_of_failure" class="external-link">sometimes
with catastrophic results</a>.</p>
<p>Astropy provides tools for including units explicitly in
computations, which makes it possible to detect errors before they cause
disasters.</p>
<p>To use Astropy units, we import them like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> astropy.units <span class="im">as</span> u</span></code></pre>
</div>
<p><code>u</code> is an object that contains most common units and all
SI units.</p>
<p>You can use <code>dir</code> to list them, but you should also <a href="https://docs.astropy.org/en/stable/units/" class="external-link">read the
documentation</a>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="bu">dir</span>(u)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>['A',
 'AA',
 'AB',
 'ABflux',
 'ABmag',
 'AU',
 'Angstrom',
 'B',
 'Ba',
 'Barye',
 'Bi',
[Output truncated]</code></pre>
</div>
<p>To create a quantity, we multiply a value by a unit:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>angle <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> u.degree</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="bu">type</span>(angle)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">astropy.units.quantity.Quantity</span></span></code></pre>
</div>
<p>The result is a <code>Quantity</code> object. Jupyter knows how to
display <code>Quantities</code> like this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>angle</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Quantity 10. deg&gt;</code></pre>
</div>
<p>10<sup>°</sup></p>
<p><code>Quantities</code> provides a method called <code>to</code> that
converts to other units. For example, we can compute the number of
arcminutes in <code>angle</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>angle_arcmin <span class="op">=</span> angle.to(u.arcmin)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>angle_arcmin</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Quantity 600. arcmin&gt;</code></pre>
</div>
<p>600<sup>′</sup></p>
<p>If you add quantities, Astropy converts them to compatible units, if
possible:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>angle <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> u.arcmin</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Quantity 10.5 deg&gt;</code></pre>
</div>
<p>10.5<sup>°</sup></p>
<p>If the units are not compatible, you get an error. For example:</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code><span><span class="va">angle</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">u.kg</span></span></code></pre>
</div>
<p>causes a <code>UnitConversionError</code>.</p>
<div id="exercise-5-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-5-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (5 minutes)</h3>
<div class="callout-content">
<p>Create a quantity that represents 5 <a href="https://en.wikipedia.org/wiki/Minute_and_second_of_arc" class="external-link">arcminutes</a>
and assign it to a variable called <code>radius</code>.</p>
<p>Then convert it to degrees.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>radius <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> u.arcmin</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="bu">print</span>(radius)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>radius.to(u.degree)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="selecting-a-region">Selecting a Region<a class="anchor" aria-label="anchor" href="#selecting-a-region"></a></h2>
<hr class="half-width"><p>One of the most common ways to restrict a query is to select stars in
a particular region of the sky. For example, here is a query from the <a href="https://gea.esac.esa.int/archive-help/adql/examples/index.html" class="external-link">Gaia
archive documentation</a> that selects objects in a circular region
centered at (88.8, 7.4) with a search radius of 5 arcmin (0.08333
deg).</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>cone_query <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="st">TOP 10 </span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="st">source_id</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="st">WHERE 1=CONTAINS(</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="st">  POINT(ra, dec),</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="st">  CIRCLE(88.8, 7.4, 0.08333333))</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>This query uses three keywords that are specific to ADQL (not
SQL):</p>
<ul><li><p><code>POINT</code>: a location in <a href="https://en.wikipedia.org/wiki/International_Celestial_Reference_System" class="external-link">ICRS
coordinates</a>, specified in degrees of right ascension and
declination.</p></li>
<li><p><code>CIRCLE</code>: a circle where the first two values are the
coordinates of the center and the third is the radius in
degrees.</p></li>
<li><p><code>CONTAINS</code>: a function that returns <code>1</code> if
a <code>POINT</code> is contained in a shape and <code>0</code>
otherwise. Here is the <a href="https://www.ivoa.net/documents/ADQL/20180112/PR-ADQL-2.1-20180112.html#tth_sEc4.2.12" class="external-link">documentation
of <code>CONTAINS</code></a>.</p></li>
</ul><p>A query like this is called a cone search because it selects stars in
a cone. Here is how we run it:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">from</span> astroquery.gaia <span class="im">import</span> Gaia</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>cone_job <span class="op">=</span> Gaia.launch_job(cone_query)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>cone_job</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Created TAP+ (v1.2.1) - Connection:
	Host: gea.esac.esa.int
	Use HTTPS: True
	Port: 443
	SSL Port: 443
Created TAP+ (v1.2.1) - Connection:
	Host: geadata.esac.esa.int
	Use HTTPS: True
	Port: 443
	SSL Port: 443

&lt;astroquery.utils.tap.model.job.Job at 0x7f277785fa30&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>cone_results <span class="op">=</span> cone_job.get_results()</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>cone_results</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
     source_id
       int64
-------------------
3322773965056065536
3322773758899157120
3322774068134271104
3322773930696320512
3322774377374425728
3322773724537891456
3322773724537891328
[Output truncated]</code></pre>
</div>
<div id="exercise-5-minutes-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-5-minutes-1" class="callout-inner">
<h3 class="callout-title">Exercise (5 minutes)</h3>
<div class="callout-content">
<p>When you are debugging queries like this, you can use
<code>TOP</code> to limit the size of the results, but then you still
don’t know how big the results will be.</p>
<p>An alternative is to use <code>COUNT</code>, which asks for the
number of rows that would be selected, but it does not return them.</p>
<p>In the previous query, replace <code>TOP 10 source_id</code> with
<code>COUNT(source_id)</code> and run the query again. How many stars
has Gaia identified in the cone we searched?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>count_cone_query <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="st">COUNT(source_id)</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="st">WHERE 1=CONTAINS(</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="st">  POINT(ra, dec),</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="st">  CIRCLE(88.8, 7.4, 0.08333333))</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>count_cone_job <span class="op">=</span> Gaia.launch_job(count_cone_query)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>count_cone_results <span class="op">=</span> count_cone_job.get_results()</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>count_cone_results</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=1&gt;
count
int64
-----
594</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="getting-gd-1-data">Getting GD-1 Data<a class="anchor" aria-label="anchor" href="#getting-gd-1-data"></a></h2>
<hr class="half-width"><p>From the Price-Whelan and Bonaca paper, we will try to reproduce <a href="https://www.astroexplorer.org/details/apjlaad7b5f1/eyJrZXlXb3JkcyI6IlByaWNlLVdoZWxhbiIsImF1dGhvciI6IlByaWNlLVdoZWxhbiIsImZyb21ZZWFyIjoyMDE4LCJ0b1llYXIiOjIwMTgsInBhZ2UiOjEsInNob3ciOiIyMDAifQ" class="external-link">Figure
1</a>, which includes this representation of stars likely to belong to
GD-1:</p>
<figure><img src="fig/gd1-4.png" alt="On-sky positions of likely GD-1 members in the GD-1 coordinate system, where selection by proper motion and photometry reveals the stream in great detail." class="figure mx-auto d-block"></figure><p>The axes of this figure are defined so the x-axis is aligned with the
stars in GD-1, and the y-axis is perpendicular.</p>
<ul><li><p>Along the x-axis (φ<sub>1</sub>) the figure extends from -100 to
20 degrees.</p></li>
<li><p>Along the y-axis (φ<sub>2</sub>) the figure extends from about -8
to 4 degrees.</p></li>
</ul><p>Ideally, we would select all stars from this rectangle, but there are
more than 10 million of them. This would be difficult to work with, and
as anonymous Gaia users, we are limited to 3 million rows in a single
query. While we are developing and testing code, it will be faster to
work with a smaller dataset.</p>
<p>So we will start by selecting stars in a smaller rectangle near the
center of GD-1, from -55 to -45 degrees φ<sub>1</sub> and -8 to 4
degrees φ<sub>2</sub>. First we will learn how to represent these
coordinates with Astropy.</p>
</section><section><h2 class="section-heading" id="transforming-coordinates">Transforming coordinates<a class="anchor" aria-label="anchor" href="#transforming-coordinates"></a></h2>
<hr class="half-width"><p>Astronomy makes use of many different <a href="https://en.wikipedia.org/wiki/Celestial_coordinate_system" class="external-link">coordinate
systems</a>. Transforming between coordinate systems is a common task in
observational astronomy, and thankfully, Astropy has abstracted the
required spherical trigonometry for us. Below we show the steps to go
from Equatorial coordinates (sky coordinates) to Galactic coordinates
and finally to a reference frame defined to more easily study GD-1.</p>
<p>Astropy provides a <code>SkyCoord</code> object that represents sky
coordinates relative to a specified reference frame.</p>
<p>The following example creates a <code>SkyCoord</code> object that
represents the approximate coordinates of <a href="https://simbad.u-strasbg.fr/simbad/sim-basic?Ident=Betelgeuse" class="external-link">Betelgeuse</a>
(alf Ori) in the ICRS frame.</p>
<p><a href="https://www.iers.org/IERS/EN/Science/ICRS/ICRS.html" class="external-link">ICRS</a> is
the “International Celestial Reference System”, adopted in 1997 by the
International Astronomical Union.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">from</span> astropy.coordinates <span class="im">import</span> SkyCoord</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>ra <span class="op">=</span> <span class="fl">88.8</span> <span class="op">*</span> u.degree</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>dec <span class="op">=</span> <span class="fl">7.4</span> <span class="op">*</span> u.degree</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>coord_icrs <span class="op">=</span> SkyCoord(ra<span class="op">=</span>ra, dec<span class="op">=</span>dec, frame<span class="op">=</span><span class="st">'icrs'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>coord_icrs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (88.8, 7.4)&gt;</code></pre>
</div>
<p><code>SkyCoord</code> objects require units in order to understand
the context. There are a number of ways to define <code>SkyCoord</code>
objects, in our example, we explicitly specified the coordinates and
units and provided a reference frame.</p>
<p><code>SkyCoord</code> provides the <code>transform_to</code> function
to transform from one reference frame to another reference frame. For
example, we can transform <code>coords_icrs</code> to Galactic
coordinates like this:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>coord_galactic <span class="op">=</span> coord_icrs.transform_to(<span class="st">'galactic'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>coord_galactic</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;SkyCoord (Galactic): (l, b) in deg
    (199.79693102, -8.95591653)&gt;</code></pre>
</div>
<div id="coordinate-variables" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="coordinate-variables" class="callout-inner">
<h3 class="callout-title">Coordinate Variables</h3>
<div class="callout-content">
<p>Notice that in the Galactic frame, the coordinates are the variables
we usually use for Galactic longitude and latitude called <code>l</code>
and <code>b</code>, respectively, not <code>ra</code> and
<code>dec</code>. Most reference frames have different ways to specify
coordinates and the <code>SkyCoord</code> object will use these
names.</p>
</div>
</div>
</div>
<p>To transform to and from GD-1 coordinates, we will use a frame
defined by <a href="https://gala-astro.readthedocs.io/en/latest/" class="external-link">Gala</a>, which is
an Astropy-affiliated library that provides tools for galactic
dynamics.</p>
<p>Gala provides <a href="https://gala-astro.readthedocs.io/en/latest/_modules/gala/coordinates/gd1.html" class="external-link"><code>GD1Koposov10</code></a>,
which is “a Heliocentric spherical coordinate system defined by the
orbit of the GD-1 stream”. In this coordinate system, one axis is
defined along the direction of the stream (the x-axis in Figure 1) and
one axis is defined perpendicular to the direction of the stream (the
y-axis in Figure 1). These are called the φ<sub>1</sub> and
φ<sub>2</sub> coordinates, respectively.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="im">from</span> gala.coordinates <span class="im">import</span> GD1Koposov10</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>gd1_frame <span class="op">=</span> GD1Koposov10()</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>gd1_frame</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;GD1Koposov10 Frame&gt;</code></pre>
</div>
<p>We can use it to find the coordinates of Betelgeuse in the GD-1
frame, like this:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>coord_gd1 <span class="op">=</span> coord_icrs.transform_to(gd1_frame)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>coord_gd1</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;SkyCoord (GD1Koposov10): (phi1, phi2) in deg
    (-94.97222038, 34.5813813)&gt;</code></pre>
</div>
<div id="exercise-10-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-10-minutes" class="callout-inner">
<h3 class="callout-title">Exercise (10 minutes)</h3>
<div class="callout-content">
<p>Find the location of GD-1 in ICRS coordinates.</p>
<ol style="list-style-type: decimal"><li><p>Create a <code>SkyCoord</code> object at 0°, 0° in the GD-1
frame.</p></li>
<li><p>Transform it to the ICRS frame.</p></li>
</ol><p>Hint: Because ICRS is a standard frame, it is built into Astropy. You
can specify it by name, <code>icrs</code> (as we did with
<code>galactic</code>).</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>origin_gd1 <span class="op">=</span> SkyCoord(<span class="dv">0</span><span class="op">*</span>u.degree, <span class="dv">0</span><span class="op">*</span>u.degree, frame<span class="op">=</span>gd1_frame)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>origin_gd1.transform_to(<span class="st">'icrs'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Notice that the origin of the GD-1 frame maps to <code>ra=200</code>,
exactly, in ICRS. That is by design.</p>
</section><section><h2 class="section-heading" id="selecting-a-rectangle">Selecting a rectangle<a class="anchor" aria-label="anchor" href="#selecting-a-rectangle"></a></h2>
<hr class="half-width"><p>Now that we know how to define coordinate transformations, we are
going to use them to get a list of stars that are in GD-1. As we
mentioned before, this is a lot of stars, so we are going to start by
defining a rectangle that encompasses a small part of GD-1. This is
easiest to define in GD-1 coordinates.</p>
<p>The following variables define the boundaries of the rectangle in
φ<sub>1</sub> and φ<sub>2</sub>.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>phi1_min <span class="op">=</span> <span class="op">-</span><span class="dv">55</span> <span class="op">*</span> u.degree </span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>phi1_max <span class="op">=</span> <span class="op">-</span><span class="dv">45</span> <span class="op">*</span> u.degree</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>phi2_min <span class="op">=</span> <span class="op">-</span><span class="dv">8</span> <span class="op">*</span> u.degree</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>phi2_max <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> u.degree</span></code></pre>
</div>
<p>Throughout this lesson we are going to be defining a rectangle often.
Rather than copy and paste multiple lines of code, we will write a
function to build the rectangle for us. By having the code contained in
a single location, we can easily fix bugs or update our implementation
as needed. By choosing an explicit function name our code is also self
documenting, meaning its easy for us to understand that we are building
a rectangle when we call this function.</p>
<p>To create a rectangle, we will use the following function, which
takes the lower and upper bounds as parameters and returns a list of x
and y coordinates of the corners of a rectangle starting with the lower
left corner and working clockwise.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="kw">def</span> make_rectangle(x1, x2, y1, y2):</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="co">"""Return the corners of a rectangle."""</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    xs <span class="op">=</span> [x1, x1, x2, x2, x1]</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    ys <span class="op">=</span> [y1, y2, y2, y1, y1]</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    <span class="cf">return</span> xs, ys</span></code></pre>
</div>
<p>The return value is a tuple containing a list of coordinates in
φ<sub>1</sub> followed by a list of coordinates in φ<sub>2</sub>.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>phi1_rect, phi2_rect <span class="op">=</span> make_rectangle(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    phi1_min, phi1_max, phi2_min, phi2_max)</span></code></pre>
</div>
<p><code>phi1_rect</code> and <code>phi2_rect</code> contains the
coordinates of the corners of a rectangle in the GD-1 frame.</p>
<p>While it is easier to visualize the regions we want to define in the
GD-1 frame, the coordinates in the Gaia catalog are in the ICRS frame.
In order to use the rectangle we defined, we need to convert the
coordinates from the GD-1 frame to the ICRS frame. We will do this using
the SkyCoord object. Fortunately SkyCoord objects can take lists of
coordinates, in addition to single values.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>corners <span class="op">=</span> SkyCoord(phi1<span class="op">=</span>phi1_rect, phi2<span class="op">=</span>phi2_rect, frame<span class="op">=</span>gd1_frame)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>corners</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;SkyCoord (GD1Koposov10): (phi1, phi2) in deg
    [(-55., -8.), (-55.,  4.), (-45.,  4.), (-45., -8.), (-55., -8.)]&gt;</code></pre>
</div>
<p>Now we can use <code>transform_to</code> to convert to ICRS
coordinates.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>corners_icrs <span class="op">=</span> corners.transform_to(<span class="st">'icrs'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>corners_icrs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;SkyCoord (ICRS): (ra, dec) in deg
    [(146.27533314, 19.26190982), (135.42163944, 25.87738723),
     (141.60264825, 34.3048303 ), (152.81671045, 27.13611254),
     (146.27533314, 19.26190982)]&gt;</code></pre>
</div>
<p>Notice that a rectangle in one coordinate system is not necessarily a
rectangle in another. In this example, the result is a (non-rectangular)
polygon. This is why we defined our rectangle in the GD-1 frame.</p>
</section><section><h2 class="section-heading" id="defining-a-polygon">Defining a polygon<a class="anchor" aria-label="anchor" href="#defining-a-polygon"></a></h2>
<hr class="half-width"><p>In order to use this polygon as part of an ADQL query, we have to
convert it to a string with a comma-separated list of coordinates, as in
this example:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="co">POLYGON(143.65, 20.98, </span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="co">        134.46, 26.39, </span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="co">        140.58, 34.85, </span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="co">        150.16, 29.01)</span></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="co">"""</span></span></code></pre>
</div>
<p><code>SkyCoord</code> provides <code>to_string</code>, which produces
a list of strings.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>corners_list_str <span class="op">=</span> corners_icrs.to_string()</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>corners_list_str</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>['146.275 19.2619',
 '135.422 25.8774',
 '141.603 34.3048',
 '152.817 27.1361',
 '146.275 19.2619']</code></pre>
</div>
<p>We can use the Python string function <code>join</code> to join
<code>corners_list_str</code> into a single string (with spaces between
the pairs):</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>corners_single_str <span class="op">=</span> <span class="st">' '</span>.join(corners_list_str)</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>corners_single_str</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'146.275 19.2619 135.422 25.8774 141.603 34.3048 152.817 27.1361 146.275 19.2619'</span></span></code></pre>
</div>
<p>This is almost what we need, but we have to replace the spaces with
commas.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>corners_single_str.replace(<span class="st">' '</span>, <span class="st">', '</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'146.275, 19.2619, 135.422, 25.8774, 141.603, 34.3048, 152.817, 27.1361, 146.275, 19.2619'</span></span></code></pre>
</div>
<p>This is something we will need to do multiple times. We will write a
function to do it for us so we don’t have to copy and paste every time.
The following function combines these steps.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="kw">def</span> skycoord_to_string(skycoord):</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>    <span class="co">"""Convert a one-dimenstional list of SkyCoord to string for Gaia's query format."""</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>    corners_list_str <span class="op">=</span> skycoord.to_string()</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>    corners_single_str <span class="op">=</span> <span class="st">' '</span>.join(corners_list_str)</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>    <span class="cf">return</span> corners_single_str.replace(<span class="st">' '</span>, <span class="st">', '</span>)</span></code></pre>
</div>
<p>Here is how we use this function:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>sky_point_list <span class="op">=</span> skycoord_to_string(corners_icrs)</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>sky_point_list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'146.275, 19.2619, 135.422, 25.8774, 141.603, 34.3048, 152.817, 27.1361, 146.275, 19.2619'</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="assembling-the-query">Assembling the query<a class="anchor" aria-label="anchor" href="#assembling-the-query"></a></h2>
<hr class="half-width"><p>Now we are ready to assemble our query to get all of the stars in the
Gaia catalog that are in the small rectangle we defined and are likely
to be part of GD-1 with the criteria we previously defined.</p>
<p>We need <code>columns</code> again (as we saw in the previous
episode).</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>columns <span class="op">=</span> <span class="st">'source_id, ra, dec, pmra, pmdec, parallax'</span></span></code></pre>
</div>
<p>And here is the query base we used in the previous lesson:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>query3_base <span class="op">=</span> <span class="st">"""SELECT </span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="st">TOP 10 </span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="sc">{columns}</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="st">  AND bp_rp BETWEEN -0.75 AND 2</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>Now we will add a <code>WHERE</code> clause to select stars in the
polygon we defined and start using more descriptive variables for our
queries.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>polygon_top10query_base <span class="op">=</span> <span class="st">"""SELECT</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="st">TOP 10</span></span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="sc">{columns}</span></span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1</span></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a><span class="st">  AND bp_rp BETWEEN -0.75 AND 2 </span></span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a><span class="st">  AND 1 = CONTAINS(POINT(ra, dec), </span></span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a><span class="st">                   POLYGON(</span><span class="sc">{sky_point_list}</span><span class="st">))</span></span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<p>The query base contains format specifiers for <code>columns</code>
and <code>sky_point_list</code>.</p>
<p>We will use <code>format</code> to fill in these values.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>polygon_top10query <span class="op">=</span> polygon_top10query_base.<span class="bu">format</span>(columns<span class="op">=</span>columns, </span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>                          sky_point_list<span class="op">=</span>sky_point_list)</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="bu">print</span>(polygon_top10query)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SELECT
TOP 10
source_id, ra, dec, pmra, pmdec, parallax
FROM gaiadr2.gaia_source
WHERE parallax &lt; 1
  AND bp_rp BETWEEN -0.75 AND 2
  AND 1 = CONTAINS(POINT(ra, dec),
                   POLYGON(146.275, 19.2619, 135.422, 25.8774, 141.603, 34.3048, 152.817, 27.1361, 146.275, 19.2619))

</code></pre>
</div>
<p>As always, we should take a minute to proof-read the query before we
launch it.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>polygon_top10query_job <span class="op">=</span> Gaia.launch_job_async(polygon_top10query)</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="bu">print</span>(polygon_top10query_job)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO: Query finished. [astroquery.utils.tap.core]
&lt;Table length=10&gt;
   name    dtype    unit                              description
--------- ------- -------- ------------------------------------------------------------------
source_id   int64          Unique source identifier (unique within a particular Data Release)
       ra float64      deg                                                    Right ascension
      dec float64      deg                                                        Declination
     pmra float64 mas / yr                         Proper motion in right ascension direction
    pmdec float64 mas / yr                             Proper motion in declination direction
 parallax float64      mas                                                           Parallax
Jobid: 1615815873808O
Phase: COMPLETED
[Output truncated]</code></pre>
</div>
<p>Here are the results.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>polygon_top10query_results <span class="op">=</span> polygon_top10query_job.get_results()</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>polygon_top10query_results</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Table length=10&gt;
    source_id              ra         ...       parallax
                          deg         ...         mas
------------------ ------------------ ... --------------------
637987125186749568 142.48301935991023 ...  -0.2573448962333354
638285195917112960 142.25452941346344 ...   0.4227283465319491
638073505568978688 142.64528557468074 ...  0.10363972229362585
638086386175786752 142.57739430926034 ...  -0.8573270355079308
638049655615392384 142.58913564478618 ...    0.099624729200593
638267565075964032 141.81762228999614 ... -0.07271215219283075
[Output truncated]</code></pre>
</div>
<p>Finally, we can remove <code>TOP 10</code> and run the query
again.</p>
<p>The result is bigger than our previous queries, so it will take a
little longer.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>polygon_query_base <span class="op">=</span> <span class="st">"""SELECT</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="sc">{columns}</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a><span class="st">FROM gaiadr2.gaia_source</span></span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a><span class="st">WHERE parallax &lt; 1</span></span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a><span class="st">  AND bp_rp BETWEEN -0.75 AND 2 </span></span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a><span class="st">  AND 1 = CONTAINS(POINT(ra, dec), </span></span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a><span class="st">                   POLYGON(</span><span class="sc">{sky_point_list}</span><span class="st">))</span></span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>polygon_query <span class="op">=</span> polygon_query_base.<span class="bu">format</span>(columns<span class="op">=</span>columns, </span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>                          sky_point_list<span class="op">=</span>sky_point_list)</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a><span class="bu">print</span>(polygon_query)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SELECT
source_id, ra, dec, pmra, pmdec, parallax
FROM gaiadr2.gaia_source
WHERE parallax &lt; 1
  AND bp_rp BETWEEN -0.75 AND 2
  AND 1 = CONTAINS(POINT(ra, dec),
                   POLYGON(146.275, 19.2619, 135.422, 25.8774, 141.603, 34.3048, 152.817, 27.1361, 146.275, 19.2619))</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>polygon_job <span class="op">=</span> Gaia.launch_job_async(polygon_query)</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a><span class="bu">print</span>(polygon_job)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO: Query finished. [astroquery.utils.tap.core]
&lt;Table length=140339&gt;
   name    dtype    unit                              description
--------- ------- -------- ------------------------------------------------------------------
source_id   int64          Unique source identifier (unique within a particular Data Release)
       ra float64      deg                                                    Right ascension
      dec float64      deg                                                        Declination
     pmra float64 mas / yr                         Proper motion in right ascension direction
    pmdec float64 mas / yr                             Proper motion in declination direction
 parallax float64      mas                                                           Parallax
Jobid: 1615815886707O
Phase: COMPLETED
[Output truncated]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>polygon_results <span class="op">=</span> polygon_job.get_results()</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="bu">len</span>(polygon_results)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">140339</span></span></code></pre>
</div>
<p>There are more than 100,000 stars in this polygon, but that’s a
manageable size to work with.</p>
</section><section><h2 class="section-heading" id="saving-results">Saving results<a class="anchor" aria-label="anchor" href="#saving-results"></a></h2>
<hr class="half-width"><p>This is the set of stars we will work with in the next step. Since we
have a substantial dataset now, this is a good time to save it.</p>
<p>Storing the data in a file means we can shut down our notebook and
pick up where we left off without running the previous query again.</p>
<p>Astropy <code>Table</code> objects provide <code>write</code>, which
writes the table to disk.</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'gd1_results.fits'</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>polygon_results.write(filename, overwrite<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>Because the filename ends with <code>fits</code>, the table is
written in the <a href="https://en.wikipedia.org/wiki/FITS" class="external-link">FITS
format</a>, which preserves the metadata associated with the table.</p>
<p>If the file already exists, the <code>overwrite</code> argument
causes it to be overwritten.</p>
<p>We can use <code>getsize</code> to confirm that the file exists and
check the size:</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="im">from</span> os.path <span class="im">import</span> getsize</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>MB <span class="op">=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>getsize(filename) <span class="op">/</span> MB</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">6.4324951171875</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>In this notebook, we composed more complex queries to select stars
within a polygonal region of the sky. Then we downloaded the results and
saved them in a FITS file.</p>
<p>In the next notebook, we’ll reload the data from this file and
replicate the next step in the analysis, using proper motion to identify
stars likely to be in GD-1.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>For measurements with units, use <code>Quantity</code> objects that
represent units explicitly and check for errors.</li>
<li>Use the <code>format</code> function to compose queries; it is often
faster and less error-prone.</li>
<li>Develop queries incrementally: start with something simple, test it,
and add a little bit at a time.</li>
<li>Once you have a query working, save the data in a local file. If you
shut down the notebook and come back to it later, you can reload the
file; you don’t have to run the query again.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-query.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="03-transform.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-query.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Basic Queries
        </a>
        <a class="chapter-link float-end" href="03-transform.html" rel="next">
          Next: Plotting and Tabular...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/astronomy-python/edit/main/episodes/02-coords.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/astronomy-python/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/astronomy-python/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/astronomy-python/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.6" class="external-link">varnish (1.0.6)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://datacarpentry.github.io/astronomy-python/02-coords.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Coordinate Transformations",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/astronomy-python/02-coords.html",
  "identifier": "https://datacarpentry.github.io/astronomy-python/02-coords.html",
  "dateCreated": "2020-05-11",
  "dateModified": "2025-02-03",
  "datePublished": "2025-07-01"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

